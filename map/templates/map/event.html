{% load static %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
{% block style %}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css_event/style.css' %}">
{% endblock style %}

{% block content %}


    <!-- Navbar -->
    <header>
        <div id="navbar">
            <div class="c"><img src="{% static 'logo.jpg' %}" width="15%"></div>
            <a href="{% url 'login:logout' %}" style="margin-left: 0%;">Logout</a>
            <a href="{% url 'map:add' %}" style="margin-left: 0%;">Add Event</a>
            <a href="#" style="margin-left: 0%;">Hello {{ beaver.user.username }}</a>
        </div>
    </header>
    <div style="width: 100%;display: block">
        <img src="{{event.picture.url}}" style="width: 100% ;">
    </div>
    <br>
    <center><h3>Registering for {{event.name}} </h3></center>

    <div class="info" align="center">
        <br>
        Happening on : {{event.date}}
        <br>
        A little bit information about the event : {{ event.info }}
        <br>
        Destination : {{event.desc}}
        <br>
    </div>
    <br><br><br>
    <div class="container" style="display: flex;">
        <div style="width: 57%;">
            <svg width="800" height="600" style="position: relative; left : -100px;" xmlns="http://www.w3.org/2000/svg">
                <g>
                    <title>Layer 1</title>
                    <ellipse ry="19.5" rx="21.5" id="svg_1" cy="119.5" cx="60.5" stroke-width="1.5" stroke="#000"
                             fill="#fff"/>
                    <ellipse ry="22" rx="25.5" id="svg_2" cy="237" cx="68.5" stroke-width="1.5" stroke="#000"
                             fill="#fff"/>
                    <ellipse ry="22.5" rx="29" id="svg_3" cy="393.5" cx="90" stroke-width="1.5" stroke="#000"
                             fill="#fff"/>
                    <line stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_4" y2="216" x2="66" y1="140"
                          x1="63" stroke-width="1.5" stroke="#000" fill="none"/>
                    <line stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_6" y2="373" x2="85" y1="259"
                          x1="71" stroke-width="1.5" stroke="#000" fill="none"/>
                    <line stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_7" y2="254" x2="235" y1="254"
                          x1="235" opacity="0.5" stroke-width="1.5" stroke="#000" fill="none"/>
                    <ellipse ry="27.5" rx="31.5" id="svg_8" cy="446.5" cx="255.5" stroke-width="1.5" stroke="#000"
                             fill="#fff"/> 
                    <ellipse ry="18" rx="19" id="svg_9" cy="320" cx="237" stroke-width="1.5" stroke="#000" fill="#fff"/>
                    <line stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_10" y2="444" x2="227" y1="408"
                          x1="115" stroke-width="1.5" stroke="#000" fill="none"/>
                    <line stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_11" y2="338" x2="238" y1="421"
                          x1="250" stroke-width="1.5" stroke="#000" fill="none"/>
                    <line stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_12" y2="239" x2="100" y1="309"
                          x1="223" stroke-width="1.5" stroke="#000" fill="none"/>
                    <ellipse ry="21" rx="22" id="svg_13" cy="111" cx="225" stroke-width="1.5" stroke="#000"
                             fill="#fff"/>
                    <line stroke="#000" stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_14" y2="128"
                          x2="229" y1="303" x1="240" stroke-width="1.5" fill="none"/>
                    <line stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_15" y2="105" x2="204" y1="114"
                          x1="81" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000"
                          fill="none"/>
                    <ellipse ry="17" rx="19" id="svg_16" cy="117" cx="369" fill-opacity="null" stroke-opacity="null"
                             stroke-width="1.5" stroke="#000" fill="none"
                    / >
                    </ellipse >
                    <ellipse ry="18" rx="19" id="svg_17" cy="207" cx="366" fill-opacity="null" stroke-opacity="null"
                             stroke-width="1.5" stroke="#000" fill="none"/>
                    <line stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_18" y2="134" x2="371" y1="193"
                          x1="371" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000"
                          fill="none"/>
                    <line stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_19" y2="115" x2="249" y1="117"
                          x1="349" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000"
                          fill="none"/>
                    <line stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_20" y2="221" x2="352" y1="309"
                          x1="252" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000"
                          fill="none"/>
                    <line stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_21" y2="322" x2="370" y1="325"
                          x1="254" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000"
                          fill="none"/>
                    <ellipse stroke="#000" ry="21.5" rx="21" id="svg_22" cy="319.5" cx="393" fill-opacity="null"
                             stroke-opacity="null" stroke-width="1.5" fill="none"/>
                    <line stroke-linecap="null" stroke-linejoin="null" id="svg_23" y2="225" x2="374" y1="300" x1="388"
                          fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="none"/>
                    <line stroke-linecap="null" stroke-linejoin="null" id="svg_24" y2="489" x2="379" y1="454" x1="284"
                          fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="none"/>
                    <ellipse stroke="#000" ry="31.5" rx="33" id="svg_25" cy="497.5" cx="412" fill-opacity="null"
                             stroke-opacity="null" stroke-width="1.5" fill="none"/>
                    <line stroke-linecap="null" stroke-linejoin="null" id="svg_26" y2="340" x2="395" y1="467" x1="409"
                          fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="none"/>
                    <ellipse ry="34" rx="33.5" id="svg_28" cy="326" cx="565.5" fill-opacity="null" stroke-opacity="null"
                             stroke-width="1.5" stroke="#000" fill="none"/>
                    <line stroke-linecap="null" stroke-linejoin="null" id="svg_29" y2="294" x2="561" y1="125" x1="388"
                          fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="none"/>
                    <line stroke="#000" stroke-linecap="null" stroke-linejoin="null" id="svg_30" y2="478" x2="436"
                          y1="355" x1="551" opacity="0.5" fill-opacity="null" stroke-opacity="null" stroke-width="1.5"
                          fill="none"/>
                    <ellipse ry="17" rx="15.5" id="svg_31" cy="320" cx="471.5" fill-opacity="null" stroke-opacity="null"
                             stroke-width="1.5" stroke="#000" fill="none"/>
                    <line stroke-linecap="null" stroke-linejoin="null" id="svg_32" y2="317" x2="456" y1="317" x1="414"
                          fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="none"/>
                    <line stroke-linecap="null" stroke-linejoin="null" id="svg_33" y2="322" x2="534" y1="319" x1="488"
                          fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="none"/>
                    <ellipse ry="21" rx="26.5" id="svg_35" cy="510" cx="712.5" fill-opacity="null" stroke-opacity="null"
                             stroke-width="1.5" stroke="#000" fill="none"/>
                    <ellipse ry="23" rx="26.5" id="svg_36" cy="223" cx="721.5" fill-opacity="null" stroke-opacity="null"
                             stroke-width="1.5" stroke="#000" fill="none"/>
                    <ellipse ry="23" rx="23" id="svg_37" cy="118" cx="584" fill-opacity="null" stroke-opacity="null"
                             stroke-width="1.5" stroke="#000" fill="none"/>
                    <line stroke-linecap="null" stroke-linejoin="null" id="svg_38" y2="509" x2="686" y1="497" x1="445"
                          fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="none"/>
                    <line stroke-linecap="null" stroke-linejoin="null" id="svg_39" y2="245" x2="730" y1="489" x1="723"
                          fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="none"/>
                    <line stroke-linecap="null" stroke-linejoin="null" id="svg_40" y2="129" x2="606" y1="207" x1="705"
                          fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="none"/>
                    <line stroke-linecap="null" stroke-linejoin="null" id="svg_41" y2="110" x2="388" y1="105" x1="566"
                          fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="none"/>
                </g>
            </svg>


        </div>
        <div style="flex-grow: 1;">
            <ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#home">Single Source</a></li>
                <li><a data-toggle="tab" href="#menu1">Double Source </a></li>
            </ul>

            <div class="tab-content">
                <div id="home" class="tab-pane fade in active">

                    Single Source : you have a car and dont mind tagging along with attendees attending the same event
                    <br> of cource you will be paid as well as long as you obey with the terms and conditions set<br>
                    Please Note that The company bears no responsibility in case of theft of any items and <br>
                    the responsibility lies within the user completely<br>

                    <strong> Click on the button bellow to start matching and find a partner</strong>

                    <form method="POST">
                          {% csrf_token %}
                        <button class="button" type="submit"><span>Start Matching </span></button>
                    </form>
                </div>

                <div id="menu1" class="tab-pane fade">
                    <div style=" margin: 25px;">
                        {% if trips != None%}
                              {% for trip in trips %}
                        <div class="container" style="display: table-row;border: 1px solid black">
                            <div>
                                  {% if trip.user != beaver %}
                                <span style="text-align: left;">Name - {{ trip.user.user.username }} </span>
                                <span style="text-align: left;">Address - {{ trip.user.address }}</span>
                                <input style="align-content: right;" type="button" class="button estimate" style="margin-left: 290px;" value="Estimate" id="{{trip.user.address}}" >
                                {% endif %}
                            </div>
                        </div>
                        <br>
                        <br>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <input type="hidden" id="distance" value="{{distance}}">
    <input type="hidden" id="path" value="{{path}}">
    <input type="hidden" id="source2" value="{{beaver.address}}">
    <input type="hidden" id="desc" value="{{event.desc}}">
{% endblock content %}


{% block javascript %}
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<script type="text/javascript" hidden>
      var distance = document.getElementById("distance").value;
      var path = document.getElementById("path").value;
      var path2 = JSON.parse(path);
      console.log(distance);
      console.log(path);
      console.log(typeof(distance));
      console.log(typeof(path));
      console.log(path2);
      for(var i in path2){
                        path2[i] = "#" + path2[i];
                        $(path2[i]).css("stroke", "red");
      }

      $(document).ready(function(){
            var source = document.getElementById("source2").value;
            var desc = document.getElementById("desc").value;
            $("#"+source).css("fill", "red");
            $("#"+desc).css("fill", "green");
            $(".estimate").click(function(){
                  var arr = ["svg_4", "svg_6", "svg_7", "svg_10", "svg_11", "svg_12", "svg_14", "svg_15", "svg_18", "svg_19", "svg_20", "svg_21", "svg_23", "svg_24", "svg_26", "svg_29", "svg_30", "svg_32", "svg_33", "svg_38", "svg_39", "svg_40", "svg_41"];
                  for(var i in arr){
                        $("#"+arr[i]).css("stroke", "black");
                  }
                  var arr2 = ["svg_1", "svg_2", "svg_3", "svg_9", "svg_8", "svg_13", "svg_16", "svg_17", "svg_22", "svg_25", "svg_31", "svg_28", "svg_37", "svg_36", "svg_35"];
                  for(var i in arr2){
                        $("#"+arr2[i]).css("fill", "white");
                  }
                  var id = this.id;
                  var send = {};
                  var source2 = document.getElementById("source2").value;
                  var desc = document.getElementById("desc").value;
                  $("#"+id).css("fill", "aqua");
                  $("#"+source2).css("fill", "red");
                  $("#"+desc).css("fill", "green");
                  send['source1'] = id;
                  send['source2'] = source2;
                  send['desc'] = desc;
                  $.ajax({
                type : 'GET',
                url : "{% url 'get_it2' %}",
                data : send,
                success : function(response){
                      console.log(response['boolean']);
                    if(response['boolean']){
                        color1 = "aqua";
                    }
                    else{
                        color1 = "red";
                    }
                    console.log(response['path1']);
                    console.log(response['path2']);
                    for(var i in response['path1']){
                        response['path1'][i] = "#" + response['path1'][i];
                        $(response['path1'][i]).css("stroke", color1);
                    }

                    for(var i in response['path2']){
                        response['path2'][i] = "#" + response['path2'][i];
                        $(response['path2'][i]).css("stroke", "red");
                    }
                }    
            });
            });
      });
</script>
{% endblock javascript %}